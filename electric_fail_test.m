clear
clc
total =0;


for cycle2 = 1 : 131
    for cycle = (cycle2 + 1): 131

        K = [1.251161457	1.920215664	1.335750794	2.479361991	2.043778742	2.378360154	1.741753757	1.279459345	2.448229629	1.302507304	1.552319852	3.193567894	2.557265531	1.648156333	7.299859353	5.326427341	3.570722908	17.1225779	3.814380593	5.035873396	3.73700364	2.961821997	21.15434975	1.6643502	4.689206184	4.095405134	1.823825887	2.621377107	19.11593686	1.797765584	2.10412974	3.285174993	6.61068404	16.51953836	16.51952391	20.02873412	2.282156184	2.282156011	2.588046594	2.431081502	1.530747041	1.282141019	3.619133451	6.625482696	2.386876067	2.141577174	3.5789979	6.870673694	1.304815613	7.785480582	5.740883416	1.654918508	1.654918927	3.701611576	9.863572604	2.862250783	2.778937259	2.548701131	2.51933249	1.631558358	2.542698108	1.193424528	2.971840499	2.016100805	1.658653898	1.999556459	1.136688623	1.576229937	1.8060747	3.913005828	2.698260824	1.801833621	6.580859193	1.963396993	20.39804003	2.280835912	3.097894052	1.59112584	14.20035599	5.730184514	5.43550507	2.987423205	3.636807597	3.504595002	6.563564287	3.378416415	4.862146658	3.915023234	8.790923249	1.885478157	2.016863315	2.484387807	2.588198226	17.07718254	8.930329445	3.615287583	2.025844964	6.753487756	4.349263069	3.321842363	4.701164457	1.630483263	4.236243008	1.29869036	1.882349897	1.313405873	2.328928574	2.929115395	1.300034086	3.980022642	3.17667571	2.334489153	4.079838135	10.27872541	2.308897273	22.10397291	3.724208174	2.188871935	2.188871207	8.300965004	5.323635817	2.372887858	1.676956385	1.615527782	2.028294922	20.05427524	3.033358959	21.17065141	19.59080559	4.737339573	12.64186227
];
        K(cycle2) = 0; 
        K(cycle) = 0;
        setGlobalx(K)

        i = 1:109;
        x = sin(i);
        options = optimoptions('fsolve','Display','none');
        M = fsolve(@electric_system_analysis, x, options);
        a = 0.9;

        F(1) = K(1) * sin(M(1) - M(2));
        F(2) = K(2) * sin(M(1) - M(3));
        F(3) = K(3) * sin(M(1) - M(4));
        F(4) = K(4) * sin(M(1) - M(7));
        F(5) = K(5) * sin(M(2) - M(9));
        F(6) = K(6) * sin(M(4) - M(5));
        F(7) = K(7) * sin(M(5) - M(6));
        F(8) = K(8) * sin(M(5) - M(7));
        F(9) = K(9) * sin(M(6) - M(12));
        F(10) = K(10) * sin(M(7) - M(10));
        F(11) = K(11) * sin(M(8) - M(10));
        F(12) = K(12) * sin(M(9) - M(11));
        F(13) = K(13) * sin(M(10) - M(11));
        F(14) = K(14) * sin(M(11) - M(12));
        F(15) = K(15) * sin(M(11) - M(13));
        F(16) = K(16) * sin(M(12) - M(13));
        F(17) = K(17) * sin(M(13) - M(14));
        F(18) = K(18) * sin(M(13) - M(19));
        F(19) = K(19) * sin(M(14) - M(15));
        F(20) = K(20) * sin(M(14) - M(17));
        F(21) = K(21) * sin(M(15) - M(16));
        F(22) = K(22) * sin(M(16) - M(17));
        F(23) = K(23) * sin(M(17) - M(18));
        F(24) = K(24) * sin(M(18) - M(43));
        F(25) = K(25) * sin(M(19) - M(21));
        F(26) = K(26) * sin(M(19) - M(38));
        F(27) = K(27) * sin(M(20) - M(38));
        F(28) = K(28) * sin(M(21) - M(22));
        F(29) = K(29) * sin(M(21) - M(29));
        F(30) = K(30) * sin(M(22) - M(23));
        F(31) = K(31) * sin(M(22) - M(25));
        F(32) = K(32) * sin(M(23) - M(24));
        F(33) = K(33) * sin(M(24) - M(26));
        F(34) = K(34) * sin(M(26) - M(27));
        F(35) = K(35) * sin(M(26) - M(28));
        F(36) = K(36) * sin(M(26) - M(30));
        F(37) = K(37) * sin(M(30) - M(31));
        F(38) = K(38) * sin(M(30) - M(32));
        F(39) = K(39) * sin(M(30) - M(33));
        F(40) = K(40) * sin(M(30) - M(85));
        F(41) = K(41) * sin(M(33) - M(83));
        F(42) = K(42) * sin(M(34) - M(35));
        F(43) = K(43) * sin(M(34) - M(50));
        F(44) = K(44) * sin(M(34) - M(67));
        F(45) = K(45) * sin(M(34) - M(68));
        F(46) = K(46) * sin(M(35) - M(36));
        F(47) = K(47) * sin(M(36) - M(37));
        F(48) = K(48) * sin(M(37) - M(38));
        F(49) = K(49) * sin(M(37) - M(39));
        F(50) = K(50) * sin(M(38) - M(39));
        F(51) = K(51) * sin(M(39) - M(44));
        F(52) = K(52) * sin(M(40) - M(41));
        F(53) = K(53) * sin(M(41) - M(42));
        F(54) = K(54) * sin(M(41) - M(44));
        F(55) = K(55) * sin(M(43) - M(62));
        F(56) = K(56) * sin(M(43) - M(64)); 
        F(57) = K(57) * sin(M(43) - M(66));
        F(58) = K(58) * sin(M(44) - M(45));
        F(59) = K(59) * sin(M(44) - M(60));
        F(60) = K(60) * sin(M(45) - M(46));
        F(61) = K(61) * sin(M(46) - M(48));
        F(62) = K(62) * sin(M(46) - M(52));
        F(63) = K(63) * sin(M(46) - M(59)); 
        F(64) = K(64) * sin(M(47) - M(48));
        F(65) = K(65) * sin(M(48) - M(49)); 
        F(66) = K(66) * sin(M(50) - M(51));
        F(67) = K(67) * sin(M(52) - M(53));
        F(68) = K(68) * sin(M(52) - M(58));
        F(69) = K(69) * sin(M(53) - M(54));
        F(70) = K(70) * sin(M(54) - M(55));
        F(71) = K(71) * sin(M(54) - M(70));
        F(72) = K(72) * sin(M(54) - M(97));
        F(73) = K(73) * sin(M(55) - M(56));
        F(74) = K(74) * sin(M(56) - M(57));
        F(75) = K(75) * sin(M(56) - M(62));
        F(76) = K(76) * sin(M(58) - M(59));
        F(77) = K(77) * sin(M(59) - M(60));
        F(78) = K(78) * sin(M(60) - M(61));
        F(79) = K(79) * sin(M(60) - M(104));
        F(80) = K(80) * sin(M(62) - M(63));
        F(81) = K(81) * sin(M(63) - M(64));
        F(82) = K(82) * sin(M(63) - M(105));
        F(83) = K(83) * sin(M(65) - M(69));
        F(84) = K(84) * sin(M(65) - M(72));
        F(85) = K(85) * sin(M(65) - M(80));
        F(86) = K(86) * sin(M(67) - M(68));
        F(87) = K(87) * sin(M(68) - M(69));
        F(88) = K(88) * sin(M(68) - M(70));
        F(89) = K(89) * sin(M(69) - M(82));
        F(90) = K(90) * sin(M(70) - M(71));
        F(91) = K(91) * sin(M(72) - M(73));
        F(92) = K(92) * sin(M(72) - M(74));
        F(93) = K(93) * sin(M(74) - M(75));
        F(94) = K(94) * sin(M(74) - M(81));
        F(95) = K(95) * sin(M(74) - M(97));
        F(96) = K(96) * sin(M(75) - M(76));
        F(97) = K(97) * sin(M(75) - M(78));
        F(98) = K(98) * sin(M(76) - M(77));
        F(99) = K(99) * sin(M(77) - M(79));
        F(100) = K(100) * sin(M(77) - M(94));
        F(101) = K(101) * sin(M(79) - M(80));
        F(102) = K(102) * sin(M(80) - M(82));
        F(103) = K(103) * sin(M(80) - M(87));
        F(104) = K(104) * sin(M(81) - M(82));
        F(105) = K(105) * sin(M(82) - M(83));
        F(106) = K(106) * sin(M(82) - M(84));
        F(107) = K(107) * sin(M(84) - M(94));
        F(108) = K(108) * sin(M(85) - M(86));
        F(109) = K(109) * sin(M(85) - M(89));
        F(110) = K(110) * sin(M(86) - M(87));
        F(111) = K(111) * sin(M(86) - M(88));
        F(112) = K(112) * sin(M(86) - M(94));
        F(113) = K(113) * sin(M(88) - M(89));
        F(114) = K(114) * sin(M(88) - M(91));
        F(115) = K(115) * sin(M(89) - M(90));
        F(116) = K(116) * sin(M(91) - M(92));
        F(117) = K(117) * sin(M(92) - M(93));
        F(118) = K(118) * sin(M(94) - M(95));
        F(119) = K(119) * sin(M(94) - M(96));
        F(120) = K(120) * sin(M(97) - M(98));
        F(121) = K(121) * sin(M(98) - M(99));
        F(122) = K(122) * sin(M(99) - M(100));
        F(123) = K(123) * sin(M(99) - M(102));
        F(124) = K(124) * sin(M(100) - M(101));
        F(125) = K(125) * sin(M(103) - M(104));
        F(126) = K(126) * sin(M(104) - M(106));
        F(127) = K(127) * sin(M(105) - M(106));
        F(128) = K(128) * sin(M(105) - M(107));
        F(129) = K(129) * sin(M(106) - M(108));
        F(130) = K(130) * sin(M(107) - M(108));
        F(131) = K(131) * sin(M(108) - M(109));


        num = 0;
        for j = 1:131
            F(j) = abs(F(j));
            if F(j) > a * K(j)
                num = num + 1;
                fprintf('%d, ',j);
            end       
        end
        fprintf('\n%d, %d cycle, %d fail\n',cycle2, cycle, num);

        if num > 0
           total = total + 1;
        end
        
    end
end
  